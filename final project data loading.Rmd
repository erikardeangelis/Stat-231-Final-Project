---
title: "Final Project Data"
output:
  pdf_document: default
  html_notebook: default
---

```{r}
library(mdsr)   # Load additional packages here
library(tidyverse)

# Some customization.  You can alter or delete as desired (if you know what you are doing).
trellis.par.set(theme=theme.mosaic()) # change default color scheme for lattice
knitr::opts_chunk$set(
  tidy=FALSE,     # display code as typed
  size="small")
```


```{r}
library(readr)
outbreaks_dataset <- read_csv("data/outbreaks dataset.csv")
View(outbreaks_dataset)
table(outbreaks_dataset$State)

outbreaks_tidy <- outbreaks_dataset %>%
  filter(Location == "Restaurant") 

outbreaks_by_state <- outbreaks_tidy %>%
  group_by(State, Year) %>%
  summarise(num_outbreaks = n(), num_hosp = sum(Hospitalizations, na.rm = T), num_ill = sum(Illnesses, na.rm = T), num_fatal = sum(Fatalities, na.rm = T)) %>%
  arrange(desc(num_outbreaks))

##time series plot
ggplot(outbreaks_by_state, aes(x = Year, y = num_outbreaks, col = State)) + geom_line()
```


```{r}
ecoli_data <- read_csv("data/ecoli filtered data.csv")
View(ecoli_data)
names(ecoli_data)

ecoli_clean <- ecoli_data %>%
  select(biosample_acc, collection_date, epi_type, geo_loc_name, host, isolation_source, target_creation_date, status)
```

```{r}
salmonella_1 <- read_csv("data/Salmonella Part 1.csv")
salmonella_2 <- read_csv("data/Salmonella Part 2.csv")

salmonella_dataset <- rbind(salmonella_1, salmonella_2)
View(salmonella_dataset)
names(salmonella_dataset)

salmonella_clean <- salmonella_dataset %>%
  select(biosample_acc, epi_type, geo_loc_name, host, scientific_name, sra_release_date, strain, target_creation_date, status, isolation_source, collection_date)
```

```{r}
#importing florida restaurant data
for(month in c('01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12')){
  for(year in 10:15){
    url <- sprintf('ftp://dbprftp.state.fl.us/pub/llweb/rdar%s%s.csv', month, year)
    monthly_df <- read_csv(url, col_names=F)
    write.csv(monthly_df, sprintf('data/florida_violation_%s_%s', month, year), row.names=F)
  }
}

current_bind <- rbind(read_csv('data/florida_violation_01_10'), read_csv('data/florida_violation_01_11'))

for(month in c('01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12')){
  for(year in 10:15){
  if((month != '01' & year != '10') & (month != '01' & year != '11')){
  str <- sprintf('data/florida_violation_%s_%s', month, year)
  current_bind <- rbind(current_bind, read_csv(str))
  }
  }
}

#not working right now
all_florida_restaurants <- current_bind
library(lubridate)

restaurants <- all_florida_restaurants %>%
  filter(!is.na(X11)) %>%
  mutate(date = mdy(all_florida_restaurants$X11, format="%m/%d/%Y"))
         
table(restaurants$date)
```

```{r}
#outbreaks for florida
outbreaks_florida <- outbreaks_tidy %>%
  filter(State == "Florida") %>%  
  group_by(State, Year, Month) %>%
  summarise(num_outbreaks = n(), num_hosp = sum(Hospitalizations, na.rm = T), num_ill = sum(Illnesses, na.rm = T), num_fatal = sum(Fatalities, na.rm = T)) %>%
  arrange(desc(num_outbreaks))
  

ggplot(outbreaks_florida, aes(x = Year, y = num_outbreaks)) + geom_point() + geom_smooth(se = F)
```

```{r}
#restaurant violations per year


```

